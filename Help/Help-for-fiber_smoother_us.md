# Help for the function <i>fiber_smoother_us</i>, v. 0.1.x

## Introduction

This help file contains information about
1) [Purpose of the program](https://github.com/bdamon/MuscleUS_Toolbox/blob/master/Help/Help-for-fiber_smoother_us.md#1-purpose)
2) [Usage of the program](https://github.com/bdamon/MuscleUS_Toolbox/blob/master/Help/Help-for-fiber_smoother_us.md#2-usage)
3) [Syntax](https://github.com/bdamon/MuscleUS_Toolbox/blob/master/Help/Help-for-fiber_smoother_us.md#3-Syntax)
4) [Example Code](https://github.com/bdamon/MuscleUS_Toolbox/blob/master/Help/Help-for-fiber_smoother_us.md#4-Example-Code)
5) [Acknowledgements](https://github.com/bdamon/MuscleUS_Toolbox/blob/master/Help/Help-for-fiber_smoother_us.md#5-Acknowledgements)

## 1. Purpose
 
The function <i>fiber_smoother_us</i> is used to smooth fiber tracts and increase the spatial resolution of fiber tracts generated using the MuscleUS_Toolbox.

[Back to the top](https://github.com/bdamon/MuscleUS_Toolbox/blob/master/Help/Help-for-fiber_smoother_us.md)

## 2. Usage
The user inputs the fiber tracts generated by fiber_track_us, a structure containing the image metadata, and a structure with options for implementing the polynomial fitting routines.  The {row column} positions are separately fitted to N<sup>th</sup>-order polynomials as functions of pixel-distance along the tract. The user selects the polynomial order separately for the row and column positions. Also, the fiber tract positions are converted to units of mm and the polynomial fitting procedures are repeated, now for {X Y} positions. The function call can be configured to automatically visualize the outcomes.

For both fitting procedures, the function returns the smoothed fiber tracts and matrices containing the polynomial coefficients for each tract

[Back to the top](https://github.com/bdamon/MuscleUS_Toolbox/blob/master/Help/Help-for-fiber_smoother_us.md)

## 3. Syntax

[smoothed_fiber_all_pixels, smoothed_fiber_all_mm, coeff_c_pixels, coeff_r_pixels, coeff_x_mm, coeff_y_mm] = ...
    fiber_smoother_us(fiber_all_pixels, image_info_struc, fs_options, image_doub, roi_struc);

The input arguments are:
 
* <i>fiber_all_pixels</i>: The original fiber tracts, with units of pixels, output from [<i>fiber_track_us</i>](https://github.com/bdamon/MuscleUS_Toolbox/blob/master/Help/Help-for-fiber_track_us.md)

* <i>image_info_struc</i>: A structure containing image metadata, output from [<i>read_dicom_us</i>](https://github.com/bdamon/MuscleUS_Toolbox/blob/master/Help/Help-for-read_dicom_us.md)

* <i>fs_options</i>: A structure containing the following fields:

  <i>.interp_distance</i>: An interpolation interval for the fitted fiber tracts, in units of mm.  For example, setting <i>interp_distance</i> to 0.25 would interpolate the fiber tract at intervals of 0.25 mm. Prior to fitting the pixel positions, <i>interp_distance</i> is converted to units of pixels.
  
  <i>.poly_order</i>: A 2-element vector containing the polynomial orders, [N<sub>R</sub> N<sub>C</sub>], to use when fitting the tracts

* <i>image_doub, roi_struc, fv_options</i> (optional): The double-precision image and a structure containing information about the aponeurosis surface. If included, [<i>fiber_visualizer_us</i>](https://github.com/bdamon/MuscleUS_Toolbox/blob/master/Help/Help-for-fiber_visualizer_us.md) is automatically called so that the smoothed tracts can be visualized.

The output arguments are:

* <i>smoothed_fiber_all_pixels, smoothed_fiber_all_mm</i>: The fiber tracts following N<sup>th</sup> order polynomial fitting, with units of pixels and mm, respectively

* <i>coeff_c_pixels, coeff_x_mm</i>: Matrices of the N<sup>th</sup> order polynomial coefficients for the tracts' column/X positions, with units of pixels and mm, respectively

* <i>coeff_r_pixels, coeff_y_mm</i>: Matrices of the N<sup>th</sup> order polynomial coefficients for the tracts' row/Y positions, with units of pixels and mm, respectively

[Back to the top](https://github.com/bdamon/MuscleUS_Toolbox/blob/master/Help/Help-for-fiber_smoother_us.md)

## 4. Example Code

% set options

fs_options.poly_order = [3 3];  %3rd order polynomial fitting

fs_options.interp_distance = 0.1;   %interpolate fitted tracts at 0.1 mm spacing

% call the function:

[smoothed_fiber_all_pixels, smoothed_fiber_all_mm, coeff_c_pixels, coeff_r_pixels, coeff_x_mm, coeff_y_mm] = ...
    fiber_smoother_us(fiber_all, image_info_struc, fs_options, image_gray, roi_struc, fv_options);
  

  
[Back to the top](https://github.com/bdamon/MuscleUS_Toolbox/blob/master/Help/Help-for-fiber_smoother_us.md)

## 5. Acknowledgements
 People: Bruce Damon, Hannah Kilpatrick
 
 Grant support: NIH/NIAMS R01 AR073831

[Back to the top](https://github.com/bdamon/MuscleUS_Toolbox/blob/master/Help/Help-for-fiber_smoother_us.md)
